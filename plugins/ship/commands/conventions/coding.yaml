# KOS Coding Conventions (요약)
# 참고: docs/conventions/coding-convention.md

git_workflow:
  description: "브랜치 생성 필수 절차"
  command: |
    git checkout main && git fetch && git pull && git checkout -b {username}/KT-{TASK_ID}

branch_naming:
  format: "{username}/KT-{TASK_ID}"
  examples:
    - "say/KT-11508"
    - "carter/KT-11509"
  pattern: "^[a-z]+/KT-[0-9]+$"

commit_convention:
  format: "[KT-{TASK_ID}] {ClassName}에 {action}을/를 {verb}"
  basic_rules:
    - "반드시 [KT-{TASK_ID}] 또는 [NO-T] 접두사로 시작"
    - "한국어 문장으로 작성"
    - "현재형/명령형 사용 (예: 추가한다, 구현한다)"
    - "Co-Authored-By 라인 절대 추가 금지"
  naming_rules:
    - "새 파일 추가: {ClassName}을/를 추가한다"
    - "기존 파일에 메서드 추가: {ClassName}에 {methodName}을/를 추가/구현한다"
    - "메서드 1개: 메서드명 그대로 명시"
    - "메서드 2개 이상: 묶어서 표현 가능하나 클래스명 필수"
    - "클래스명은 반드시 실제 코드에서 사용하는 이름 그대로 명시"
  good_examples:
    - "[KT-11508] UnconfirmedMessageReader를 추가한다"
    - "[KT-11508] NhnResultCodeConverter에 queryStatus를 구현한다"
    - "[KT-11508] ToastAlimtalkSender에 queryStatus를 추가한다"
    - "[KT-11508] MessageStatusSyncTask를 추가한다"
    - "[NO-T] NhnResultCodeConverter에 메시지 변환 메서드를 구현한다"
  bad_examples:
    - "알림톡 배치 구현  # Task ID 누락"
    - "[KT-11508] Implement...  # 영어 사용"
    - "[KT-11508] 코드 수정  # 불명확"
    - "[KT-11508] 미확인 메시지 조회 인터페이스를 추가한다  # 클래스명 누락"
    - "[KT-11508] NHN 응답 코드를 메시지 상태로 변환하는 컨버터를 추가한다  # 설명적, 클래스명 누락"

pr_guidelines:
  size_limit:
    max_lines: 300
    description: "변경사항은 300줄 이하 지향 (테스트 코드 제외)"
    split_strategy: "큰 작업은 여러 개의 작은 PR로 분할"
  scope:
    principle: "하나의 PR에는 하나의 컨텍스트만 포함"
    avoid: "여러 독립적인 변경사항을 섞지 않음"
  title_format: "[KT-{TASK_ID}] 한국어로 작성된 변경사항 요약"
  recommended_commit_count: 3

test_inclusion:
  description: "테스트 코드 포함 규칙"
  unit_test:
    rule: "단위테스트는 해당 인터페이스/구현체 커밋에 포함"
    reason: "구현과 테스트가 함께 리뷰되어야 코드 품질 보장"
    examples:
      - "UnconfirmedMessageReader 구현 + UnconfirmedMessageReaderTest → 같은 커밋"
      - "ToastAlimtalkSender.queryStatus() 추가 + queryStatus 단위테스트 → 같은 커밋"
  integration_test:
    rule: "통합테스트는 선행 인터페이스/구현체가 모두 구현된 후 별도 커밋"
    reason: "여러 컴포넌트 간 상호작용 테스트는 의존성이 모두 준비된 후 가능"
    examples:
      - "MessageStatusSyncTask 통합테스트 → Sender, Reader 구현 완료 후 별도 커밋"

commit_splitting:
  description: "커밋 분할 규칙"
  principles:
    buildable_unit:
      rule: "각 커밋은 반드시 빌드와 테스트가 통과하는 상태여야 함"
      reason: "어떤 커밋에서도 git checkout 후 빌드 가능해야 함"
    single_context:
      rule: "하나의 커밋에는 하나의 컨텍스트만 포함"
      strategies:
        - "모듈별 분리 (api, batch, domain, data, sender 등)"
        - "레이어별 분리 (domain → data → api 순)"
        - "기능별 분리 (새 기능 vs 수정 vs 테스트)"
  ordering:
    rule: "테스트 인프라/의존성은 구현체보다 먼저 커밋"
    reason: "구현체 + 테스트를 한 커밋에 포함하려면 테스트가 컴파일되어야 함"
    examples:
      - "build.gradle 의존성 추가 → 구현체 + 테스트"
      - "TestConfiguration 추가 → 통합테스트"

merge_strategy:
  allowed: "rebase and merge"
  allowed_description: "선형 히스토리 유지"
  forbidden:
    - name: "merge commit"
      reason: "비선형 그래프"
    - name: "squash merge"
      reason: "커밋 히스토리 소실"

comment_handling:
  correct_method:
    name: "git commit --amend"
    commands: |
      git add .
      git commit --amend --no-edit
      git push -f
  wrong_method:
    description: "새 커밋 추가"
    example: 'git commit -m "[KT-11508] 코멘트 반영"'

auto_ship_validation:
  description: "auto-ship 스킬에서 자동 검증되는 단계"
  checks:
    branch:
      phase: "Phase 0: 사전 검증"
      validates: "브랜치명 형식 ({username}/KT-{TASK_ID})"
    commit:
      phase: "Phase 5: 커밋 생성"
      validates:
        - "Task ID 포함 여부"
        - "한국어 사용 여부"
    pr_size:
      phase: "Phase 6: 컨벤션 검증"
      validates:
        - "300줄 제한 (테스트 제외)"
        - "파일 수 제한"
    pr_scope:
      phase: "Phase 6: 컨벤션 검증"
      validates:
        - "단일 컨텍스트 원칙"
        - "모듈/레이어 분리"

references:
  full_conventions: "docs/conventions/coding-convention.md"
  task_principles: "conventions/task.md"
  validation_rules: "conventions/validation.md"
